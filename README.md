[![RGL.gg](https://img.shields.io/badge/RGL.gg-blue?logo=data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABEXAAARFwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKITtQenz/f/6/P//+vz///r8///6/P///////4u89cYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACeD7EHu9f7///////////////////////////+MvvbGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlguxB+Pv///////////////////7+/v//////jL72xgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATZjvPkaV8P9VnfH/h7n1/9Xn/P/5+/7//////4u99sUAAAAAAAAAAAAAAAAAAAAATJjwv0uW782SwfbNh7v1zUyX8NpMl+//TJfv/0uX7/9Ll+//XKDx/9vq/P+rz/j0j8D2zJDA9s2QwPbNjr/2zU2X8O9Klu//5/H8//n7/v9XnfD/TZjw/k2Y8P9NmPD/TZjw/02Y8P9GlO/+vtr6//////////////////////9NmPDuTJfv/67Q+P//////cKzz/0yX7/9NmPD/TZjw/02Y8P9NmPD/TZjw/02Y8P/d6/z////////////6/P//TZjw7k2Y8P9tqvL//////8vh+v9AkO7/TJfv/02Y8P9NmPD/TZjw/02Y8P9Ml+//Tpnv//r8////////+vz//02Y8O5NmPD/QZHu/+z0/f//////psz4/4O39P9QmvD/TJfv/0mV7/9Sm/D/ca3z/63Q+P/2+f7///////r8//9NmPDuTZjw/1ad8P/+/v//////////////////5O/9/1Sb8P+61/n/+vv+//3+/v///////////////v/6/P//TZjw+UyX7/+u0Pj/6vP9/+v0/f/+/v/+/v7+/////////////////+71/f6rzvj/da/z/2Gk8f/s9f3/5vH9/0uY8DZLmPA5MYjtOSSB7Dkgf+xs7/b+///////+/v7/6/P9/3Ou8/9Dku//Spbv0kuY8DdHle85JIHsOSWC7DkAAAAAAAAAAAAAAAAAAAAAJ4PsQO71/v///////////8Hb+f9Ml+//TZjw/02Y8MUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACeD7EHu9f7///////3+/v9ipPH/TJfv/02Y8P9NmPDGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAohOxB6/T9//3+/v9vq/P/TJfv/02Y8P9MmPD/TZjwxgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASZbvPXqy8/m01PnubKry7kyX7+5NmPDuTZjw70yY8LgAAAAAAAAAAAAAAAAAAAAA8A8AAPAPAADwDwAA8A8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8A8AAPAPAADwDwAA8A8AAA==)](https://rgl.gg/?r=38)
[![Beta Build](https://github.com/RGLgg/server-resources-updater/workflows/Beta%20Build/badge.svg)](https://github.com/RGLgg/server-resources-updater/actions?query=workflow%3A%22Beta+Build%22)
[![Release Build](https://github.com/RGLgg/server-resources-updater/workflows/Release%20Build/badge.svg)](https://github.com/RGLgg/server-resources-updater/actions?query=workflow%3A%22Release+Build%22)
[![Sourcemod Version](https://img.shields.io/badge/SourceMod-v1.11-blue?labelColor=d9860a&color=5596cf)](https://www.sourcemod.net/downloads.php?branch=stable)
[![GitHub release (latest by date)](https://img.shields.io/github/v/release/RGLgg/server-resources-updater)](https://github.com/RGLgg/server-resources-updater/releases/latest)
[![GitHub All Releases](https://img.shields.io/github/downloads/RGLgg/server-resources-updater/total)](https://github.com/RGLgg/server-resources-updater/releases/latest/download/server-resources-updater.zip)
[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://github.com/RGLgg/server-resources-updater/blob/master/LICENSE)

**Please ensure you read ALL of the [Installation](https://github.com/RGLgg/server-resources-updater/tree/master#installation) section.**
Clicking on the `Clone and download` button will not work, instead ensure your server has [SourceMod 1.11](https://www.sourcemod.net/downloads.php?branch=stable) and click this badge [![GitHub All Releases](https://img.shields.io/github/downloads/RGLgg/server-resources-updater/total)](https://github.com/RGLgg/server-resources-updater/releases/latest/download/server-resources-updater.zip)

If youre running a **linux distro**, please **make sure it's up to date with EPEL**, some servers may have issues with TF2 Comp Fixes / RGL Updater.

# If you have the old version of this plugin, please reinstall the plugin from this repo!
Parts of this README are still in the process of being updated.

# Pre-Bundled Plugins & Dependencies 
* [Updater](https://git.empiresmod.com/sourcemod/Updater) 
    * Automatically updates SourceMod plugins and files.
    * Included dependency
        * [SteamWorks Extension](https://forums.alliedmods.net/showthread.php?t=229556)
    * Originally created by GoD-Tony. Edited by Neoony.
* [TF2 Competitive Fixes](https://github.com/ldesgoui/tf2-comp-fixes)
    * Various technical or gameplay changes catered towards competitive play.
    * Included dependency 
        * ~~[DHooks2](https://github.com/peace-maker/DHooks2)~~ - As of SM 1.11, it is prebundled in Sourcemod, users no longer have to manually maintain this package.
    * By twiikuu
* [Progressive Ruleset Timer Plugins](https://github.com/b4nnyBot/Progressive-Ruleset-Timer-Plugins)
    * Creates dynamic win conditions for 5CP gamemodes
    * By b4nny and Dooby Skoo
* [SrcTV+](https://github.com/dalegaard/srctvplus)
    * SrcTV+ makes the server send all events to SrcTV.
    * By GipsArm - [TFTV Thread](https://www.teamfortress.tv/46380/srctv)
* [TF2 Halftime](https://github.com/stephanieLGBT/tf2-halftime)
    * Emulates ESEA style halftimes for 5CP (halftime at 3 points or timelimit) and King of the Hill (halftime at 2 points) modes.
    * By stephanieLGBT
* [Updated Pause](https://github.com/l-Aad-l/updated-pause-plugin)
    * Updated version of F2's original [pause](https://github.com/F2/F2s-sourcemod-plugins/tree/master/pause) to prevent building of Medic ÃœberCharge during a pause .
    * Originally created by F2. Edited by Aad.
* [RGL.gg QoL Tweaks](https://github.com/RGLgg/server-resources-updater/blob/master/addons/sourcemod/scripting/rglqol.sp)
    * Adds QoL tweaks for easier competitive server management and competitive integrity
    * By stephanieLGBT and Aad
* [RGL.gg Server Resources Updater](https://github.com/RGLgg/server-resources-updater/blob/master/addons/sourcemod/scripting/rglupdater.sp)
    * Automatically updates RGL.gg plugins and files
    * By stephanieLGBT and Aad


# Server Resources for RGL.gg

Hi! This github repository contains all of the **required** plugins, configs, maps, etc. for RGL league play. The configs were created from scratch, though they were inspired by the UGC, ETF2L, and CEVO configs. The autoupdater plugin was also created from scratch, but heavily inspired by Miggy's (RIP) [UGCUpdate](https://github.com/Miggthulu/UGCUpdate) and [IntegriTF2](https://github.com/Miggthulu/IntegriTF2) plugins.

In creating the configs, I tried my best to prevent extra and/or useless commands while also minimizing the ability for cheating, exploitation, and unfair play due to preexisting client and/or server settings.

The RGL updater plugin automatically updates itself and the rest of the files downloaded to your server as this repository gets updated. 

It also contains Quality of Life tweaks for TF2 servers, such as:

* Preventing servers from automatically changing level after a match

* Warning server owners about cutting off STV before changing the level

* Automatically restarting servers after all players have left

* An automatic "Casting Antitroll" mode (enabled with `rgl_cast 1`) that locks your server's slot count at 12/12, 14/14, or 18/18, depending on what config is executed

If you find that was missed something in the configs, or if something doesn't work the way it should, and if you have a suggestion, *please submit an issue on GitHub*.

If you have problems with the plugin, or if you have a suggestion, please submit an issue with details. 


# Installation
## Prerequisites
[![Sourcemod Version](https://img.shields.io/badge/SourceMod-v1.11-blue?labelColor=d9860a&color=5596cf)](https://www.sourcemod.net/downloads.php?branch=stable)

With SM 1.10 causing issues, SM 1.11 is required for this plugin. The RGL Server Resources Updater will **only support SourceMod 1.11 and higher**. Please make sure you get the right version for your server's operating system! Any previous versions of SourceMod are **unsupported**. 

**Note**: Use the [1.11](https://www.sourcemod.net/downloads.php?branch=stable) branch instead.

This guide [here](https://wiki.alliedmods.net/Upgrading_SourceMod) contains instructions on how to upgrade the files, but please consider doing a fresh install of all your current files to avoid any potential issues. 

After installation, typing `sm version` into the server console will confirm if the update was successful.

## Install Instructions

1. [Update SourceMod to at least 1.11](https://www.sourcemod.net/downloads.php?branch=stable).
2. Download the latest zip by clicking on this badge [![GitHub All Releases](https://img.shields.io/github/downloads/RGLgg/server-resources-updater/total)](https://github.com/RGLgg/server-resources-updater/releases/latest/download/server-resources-updater.zip).

3. Navigate to your server install folder in an (S)FTP client of your choice.
4. Place everything inside the zip into the root `/tf/` folder. Overwrite any and all files that you get prompted for.
5. Done!

If you're runnning into errors, completely remove all of the old RGL configs and retry.

If you're still having trouble, there's step by step instructions with pictures over in the [wiki](https://github.com/stephanieLGBT/rgl-server-resources/wiki/Installation-Tutorial)!

## Updating Instructions

The plugin updates itself, along with the RGL configs, after every exec and changelevel. You should never manually edit any config that isn't a gamemode specific custom.cfg, because it will get automatically overwritten. This is to prevent cheating and ensure each server is running the same settings.

You will have to add new maps to your server manually as RGL introduces them to each gamemode's map pool. This is to prevent lengthly download times with the updater plugin. Simply download the new map and place it in the `/tf/maps/` folder, through an (S)FTP client of your choice, and you're done.


# !!Please read this section if you're not going to read anything else!!

There are different configs and plugins for scrims and matches if you're playing 5cp and koth in 6s. Halftimes in 5cp and koth are handled by the tf2Halftime plugin, mirrored from [here](https://github.com/stephanieLGBT/tf2-halftime).

Every other gamemode and type has the same config for scrims and matches.

Here are the configs you need to exec for specific modes and map types:


<table>
<thead>
<tr>
<th align="center" colspan="3">6s</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><b>type of game</b></td>
<td align="left"><b>config to exec</b></td>
<td align="left"><b>notes</b></td>
</tr>
<tr>
<td align="left">5cp Scrim</td>
<td align="left">rgl_6s_5cp_scrim</td>
<td align="left">winlimit 5, timelimit 30, for scrims only</td>
</tr>
<tr>
<td align="left">5cp Match</td>
<td align="left">rgl_6s_5cp_match</td>
<td align="left">First half: winlimit 3, timelimit 30, 2nd half: first to 5 or timelimit</td>
</tr>
<tr>
<td align="left">5cp Match 1st Half</td>
<td align="left">rgl_6s_5cp_match_half1</td>
<td align="left">winlimit 3, timelimit 30 (this and half2 can be used if plugin isn't available)</td>
</tr>
<tr>
<td align="left">5cp Match 2nd Half</td>
<td align="left">rgl_6s_5cp_match_half2</td>
<td align="left">winlimit 5, timelimit 30, reexec after one team has won 5 total rounds</td>
</tr>
<tr>
<td align="left">5cp Match Golden Cap</td>
<td align="left">rgl_6s_5cp_gc</td>
<td align="left">winlimit 1, no timelimit</td>
</tr>
<tr>
<td align="left">KoTH Match</td>
<td align="left">rgl_6s_koth</td>
<td align="left">winlimit 2, no timelimit, 2 halves.</td>
</tr>
<tr>
<td align="left">KoTH Scrim</td>
<td align="left">rgl_6s_koth</td>
<td align="left">winlimit 2, no timelimit, 2 halves. (can be used for matches and reexeced if plugin is not available, reexec after one team has won 4 total rounds)</td>
</tr>
<tr>
<td align="left">Playoffs KoTH</td>
<td align="left">rgl_6s_koth_bo5</td>
<td align="left">winlimit 3, no timelimit</td>
</tr>
</tbody>
</table>
<br>
<table>
<thead>
<tr>
<th align="center" colspan="3">HL</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><b>type of game</b></td>
<td align="left"><b>config to exec</b></td>
<td align="left"><b>notes</b></td>
</tr>
<tr>
<td align="left">Stopwatch</td>
<td align="left">rgl_HL_stopwatch</td>
<td align="left">winlimit 2 (best of 3)</td>
</tr>
<tr>
<td align="left">Regular Season KoTH</td>
<td align="left">rgl_HL_koth</td>
<td align="left">winlimit 2, no timelimit, 2 halves. reexec after one team has won 4 total rounds</td>
</tr>
<tr>
<td align="left">Playoffs KoTH</td>
<td align="left">rgl_HL_koth_bo5</td>
<td align="left">winlimit 3, no timelimit</td>
</tr>
</tbody>
</table>
<br>
<table>
<thead>
<tr>
<th align="center" colspan="3">7s</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><b>type of game</b></td>
<td align="left"><b>config to exec</b></td>
<td align="left"><b>notes</b></td>
</tr>
<tr>
<td align="left">Stopwatch</td>
<td align="left">rgl_7s_stopwatch</td>
<td align="left">winlimit 2 (best of 3)</td>
</tr>
<tr>
<td align="left">Regular Season KoTH</td>
<td align="left">rgl_7s_koth</td>
<td align="left">winlimit 2, no timelimit, 2 halves. reexec after one team has won 4 total rounds</td>
</tr>
<tr>
<td align="left">Playoffs KoTH</td>
<td align="left">rgl_7s_koth_bo5</td>
<td align="left">winlimit 3, no timelimit</td>
</tr>
</tbody>
</table>
<br>
<table>
<thead>
<tr>
<th align="center" colspan="3">NR 6s</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><b>type of game</b></td>
<td align="left"><b>config to exec</b></td>
<td align="left"><b>notes</b></td>
</tr>
<tr>
<td align="left">5cp</td>
<td align="left">rgl_mm_5cp</td>
<td align="left">winlimit 4, no timelimit</td>
</tr>
<tr>
<td align="left">Stopwatch</td>
<td align="left">rgl_mm_stopwatch</td>
<td align="left">winlimit 2 (best of 3)</td>
</tr>
<tr>
<td align="left">Regular Season KoTH</td>
<td align="left">rgl_mm_koth</td>
<td align="left">winlimit 2, no timelimit, 2 halves. reexec after one team has won 4 total rounds</td>
</tr>
<tr>
<td align="left">Playoffs KoTH</td>
<td align="left">rgl_mm_koth_bo5</td>
<td align="left">winlimit 3, no timelimit</td>
</tr>
</tbody>
</table>
<br>


### Reset Config

`(rcon) exec rgl_off`

This will reset your server to default settings, plus whatever you have set in server.cfg. It *will not* unload the STV bot (though it will stop recording). A more detailed explanation is below.


#### On the off config and STV bugginess

There is something seriously wrong with STV in TF2. For no apparent reason, when you start it up, it eats a player slot by incrementing the value of your server's `maxplayers` by 1. This isn't a problem, typically, because TF2 can technically handle 33 "players", aka 32 + STV. If you were to set +maxplayers to 33 and then add stv, things would get ugly, really quickly.

But that's not all. When the bot is unloaded, it, for no apparent reason, reads the value of `tv_maxplayers` and sets your server's visible player count to *that* number. Why? Who knows. `sv_visiblemaxplayers` has ZERO effect on this. For that reason, I decided to *not* unload the STV bot in the `rgl_off` config, as things would get broken quickly if players didn't set `tv_maxplayers` AND `sv_visiblemaxplayers` to the same value, which also has to be at or under the server's slot limit.

For this reason, and on the advice of some server network operators, I have decided to not shut down stv with rgl_off. If you need to disable the STV, please restart your server.

The bug report for this issue is [here](https://github.com/ValveSoftware/Source-1-Games/issues/2778).

## Special Thanks

thank you to steph for maintaining and updating the first iteration of the plugin, in addition to creating the configs

thank you to Aad for making the plugin

thank you to Mastercomms for helping me out with net settings

thank you to Arie from serveme for letting me run some things by him for the configs

thank you to Wiethoofd for creating all the item whitelists

thank you to JarateKing for adding a .gitattributes file and fixing typos and grammar because I suck with github and english

thank you to Sigafoo for running RGL

thank you to GoD_tony for making the original updater.smx plugin

thank you to F2 for making the original pause plugin, and others

thank you to Miggy for being a cool anticheat admin who inspired me to make the configs in the first place

and shoutouts to plenty of other people for helping me with miscellaneous other stuff


## License
This project is under the GPLv3 license. Unless otherwise stated in individual files.
